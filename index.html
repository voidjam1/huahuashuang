<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gartic Pro - è·¨å›½ç¨³å®šç‰ˆ</title>
    <script src="https://unpkg.com/mqtt@5.10.1/dist/mqtt.min.js"></script>
    <style>
        :root { --primary: #6c5ce7; --bg: #f5f6fa; --chat-bg: #fff; --guess-bg: #ffeaa7; }
        * { box-sizing: border-box; }
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: "PingFang SC", sans-serif; background: var(--bg); }
        
        /* === è§†å›¾æ§åˆ¶ === */
        #view-lobby { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: var(--primary); color: white; transition: 0.3s; }
        #view-game { width: 100%; height: 100%; display: none; grid-template-areas: "header header" "stage side"; grid-template-columns: 1fr 320px; grid-template-rows: 60px 1fr; }

        /* === å¤§å…æ ·å¼ === */
        .lobby-card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: center; width: 90%; max-width: 400px; color: #333; }
        .lobby-input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #eee; border-radius: 8px; font-size: 16px; outline: none; transition: 0.2s; }
        .lobby-input:focus { border-color: var(--primary); }
        .lobby-btn { width: 100%; padding: 12px; margin-top: 10px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-create { background: var(--primary); color: white; }
        .btn-join { background: #00b894; color: white; }
        .divider { margin: 20px 0; color: #999; font-size: 14px; }

        /* === æ¸¸æˆç•Œé¢æ ·å¼ === */
        @media (max-width: 768px) {
            #view-game { grid-template-areas: "header" "stage" "interaction"; grid-template-columns: 1fr; grid-template-rows: 50px 1fr 260px; }
        }

        /* é¡¶éƒ¨æ  */
        header { grid-area: header; background: #fff; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 10; }
        .score-board { display: flex; gap: 10px; font-weight: bold; font-size: 14px; }
        .score-item { background: #f1f2f6; padding: 5px 12px; border-radius: 15px; display: flex; align-items: center; gap: 5px; }
        .room-tag { background: #ffeaa7; color: #d35400; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-left: 10px; cursor: pointer;}

        /* ç”»æ¿åŒº */
        .stage-area { grid-area: stage; position: relative; margin: 10px; background: white; border-radius: 10px; border: 2px solid var(--primary); overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        canvas { touch-action: none; width: 100%; height: 100%; cursor: crosshair; }

        /* äº¤äº’åŒº (åˆ†ç¦») */
        .interaction-panel { grid-area: side; display: flex; flex-direction: column; padding: 10px; gap: 8px; background: #f1f2f6; border-left: 2px solid #dfe6e9; }
        .zone-label { font-size: 12px; font-weight: bold; color: #636e72; margin-bottom: 4px; display: flex; justify-content: space-between; }
        
        .guess-zone { flex: 1; display: flex; flex-direction: column; min-height: 120px; }
        #guess-list { flex: 1; background: #fff9db; border: 2px dashed #ffeaa7; border-radius: 8px; padding: 8px; overflow-y: auto; font-size: 13px; margin-bottom: 5px; }
        
        .chat-zone { flex: 1.5; display: flex; flex-direction: column; }
        #chat-list { flex: 1; background: #ffffff; border: 1px solid #dfe6e9; border-radius: 8px; padding: 8px; overflow-y: auto; font-size: 13px; margin-bottom: 5px; }

        .input-group { display: flex; gap: 5px; }
        .input-group input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; outline: none; }
        .input-guess { border: 2px solid #f1c40f !important; background: #fffbf0; }
        .btn-mini { padding: 0 12px; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; }

        /* æ¶ˆæ¯æ°”æ³¡ */
        .msg-item { margin-bottom: 4px; line-height: 1.4; word-break: break-all; }
        .sys-msg { text-align: center; background: rgba(0,0,0,0.05); border-radius: 4px; padding: 2px; font-size: 12px; margin: 5px 0; color: #666; }

        /* å·¥å…·æ  */
        #painter-tools { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: none; background: rgba(255,255,255,0.95); padding: 8px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); gap: 10px; align-items: center; }
        
        /* é®ç½©å±‚ */
        #round-overlay { position: absolute; inset: 0; background: rgba(255,255,255,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 50; }
        .big-btn { padding: 10px 20px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; color: white; margin: 5px; }
    </style>
</head>
<body>

<div id="view-lobby">
    <div class="lobby-card">
        <h1>ğŸ¨ ä½ ç”»æˆ‘çŒœ Pro</h1>
        <p style="color:#666; margin-bottom:20px;">è·¨å›½ä½å»¶è¿Ÿ | ç¨³å®šè¿æ¥</p>
        
        <input type="text" id="lobby-nickname" class="lobby-input" placeholder="è¯·è¾“å…¥ä½ çš„æ˜µç§° (å¿…å¡«)">
        
        <button class="lobby-btn btn-create" onclick="network.createRoom()">ğŸ  åˆ›å»ºæ–°æˆ¿é—´</button>
        
        <div class="divider">æˆ–è€…</div>
        
        <input type="number" id="lobby-roomid" class="lobby-input" placeholder="è¾“å…¥ 6 ä½æˆ¿é—´å·">
        <button class="lobby-btn btn-join" onclick="network.joinRoom()">ğŸš€ åŠ å…¥æˆ¿é—´</button>
        
        <p id="lobby-status" style="margin-top:15px; font-size:12px; color:#d63031; min-height:1.2em;"></p>
    </div>
</div>

<div id="view-game">
    <header>
        <div style="display:flex; align-items:center;">
            <div class="score-board">
                <div class="score-item" style="color:var(--primary)">ğŸ‘‘ <span id="name-host">æˆ¿ä¸»</span>: <span id="score-host">0</span></div>
                <div class="score-item" style="color:#00b894">ğŸ§¢ <span id="name-guest">ç­‰å¾…...</span>: <span id="score-guest">0</span></div>
            </div>
            <div class="room-tag" title="ç‚¹å‡»å¤åˆ¶" onclick="copyRoomID()">
                æˆ¿å·: <span id="display-room-id">000000</span> ğŸ“‹
            </div>
        </div>
        <div id="game-status" style="font-weight:bold; color:#d63031; font-size:14px;">ç­‰å¾…å¼€å§‹...</div>
        <div id="timer">â±ï¸ --</div>
    </header>

    <main class="stage-area">
        <canvas id="mainCanvas"></canvas>
        
        <div id="painter-tools">
            <input type="color" id="colorPicker" value="#000000">
            <input type="range" id="sizePicker" min="2" max="20" value="5">
            <button class="btn-mini" style="background:#ff7675; padding:5px 10px;" onclick="board.clear()">ğŸ—‘ï¸</button>
            <button class="btn-mini" style="background:#00b894; padding:5px 10px;" onclick="engine.endRound(false)">â­ï¸ è·³è¿‡</button>
        </div>

        <div id="round-overlay">
            <h2 id="round-msg">å‡†å¤‡å¥½äº†å—ï¼Ÿ</h2>
            <h1 id="round-word" style="color:var(--primary); font-size:40px; margin:20px 0;">Wait</h1>
            
            <div id="overlay-btns" style="display:flex; gap:10px;">
                <button class="big-btn" style="background:#fdcb6e; color:#333;" onclick="engine.saveImage()">ğŸ’¾ ä¸‹è½½ç”»ä½œ</button>
                <button id="btn-start-game" class="big-btn" style="background:var(--primary); display:none;" onclick="engine.startGame()">ğŸ¬ å¼€å§‹æ¸¸æˆ</button>
                <button id="btn-next-round" class="big-btn" style="background:var(--primary); display:none;" onclick="engine.nextRound()">â¡ï¸ ä¸‹ä¸€è½®</button>
            </div>
        </div>
    </main>

    <div class="interaction-panel">
        <div class="guess-zone">
            <div class="zone-label">ğŸ¤” çŒœç­”æ¡ˆ (ä»…è¿™é‡Œè¾“å…¥ç­”æ¡ˆ)</div>
            <div id="guess-list"></div>
            <div class="input-group">
                <input type="text" id="guess-input" class="input-guess" placeholder="ç­”æ¡ˆæ˜¯..." onkeypress="if(event.key==='Enter') engine.sendGuess()">
                <button class="btn-mini" style="background:#f1c40f; color:#333;" onclick="engine.sendGuess()">æäº¤</button>
            </div>
        </div>
        <div class="chat-zone">
            <div class="zone-label">ğŸ’¬ èŠå¤©åæ§½</div>
            <div id="chat-list"></div>
            <div class="input-group">
                <input type="text" id="chat-input" placeholder="è¯´ç‚¹ä»€ä¹ˆ..." onkeypress="if(event.key==='Enter') engine.sendChat()">
                <button class="btn-mini" style="background:var(--primary);" onclick="engine.sendChat()">å‘é€</button>
            </div>
        </div>
    </div>
</div>

<script src="painter.js"></script>
<script src="engine.js"></script>
<script src="network.js"></script>
<script>
    // å…¨å±€åˆå§‹åŒ–
    const board = new DrawingBoard('mainCanvas', (data) => {
        data.cat = 'paint';
        network.send(data); // è¿™é‡Œçš„ network åœ¨ network.js åŠ è½½åå¯ç”¨
    });
    const engine = new GameEngine(board);

    function copyRoomID() {
        const id = document.getElementById('display-room-id').innerText;
        navigator.clipboard.writeText(id).then(() => alert(`æˆ¿å· ${id} å·²å¤åˆ¶ï¼`));
    }
</script>
</body>
</html>
